<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="js/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="js/jquery.mobile-1.3.0-rc.1.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/a3.css">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/jqm-demos.css">
    <link rel="stylesheet" href="css/jquery.mobile-1.3.0-rc.1.css">
    <script src="js/jquery.mobile.pagination.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/jquery.mobile.pagination.css">
</head>
<body>
	<div data-role="page" id="home">
		<div data-role="header" data-theme="b">
			<h1>My Favourite Things</h1>
		</div><!-- /header -->

		<div data-role="content">
			<div data-demo-html="true">
				<ul data-role="listview" data-inset="true">
					<li data-role="list-divider" hidden="true"> Welcome! </li>
					<li> This application will organize list of favourites in twitter. Swipe right on the bottom strip to start the application</li>
				</ul>
			</div>
		</div>

		<div class="jqm-footer">
			<ul data-role="listview" data-inset="true">
				<li id="StartApp" class="changePage">
					Let's start the application >>>>
					<input id='swipePageHome' type=hidden right='#page1'></input>
				</li>
			</ul>
		</div>
	</div>

</body>


/* Script for creating new page and inserting tweets */
<script type="text/javascript">
    $.getJSON('favs.json', function (data) {
		var numPage = 1;
		var lastPage = 0;
		var tweetsPerPage = 10;
		var count = 1;
        $.each(data, function (index) {
			if (count > tweetsPerPage)
			{ // if tweet count exceeds 10 per page, reset the count and increment pageNum
				count = 1;
				numPage = numPage + 1;
			}

			if (count == 1)
			{ // if count = 0, we need to make new page
				$('#tweet'+numPage-1).listview("refresh");
				makePage(numPage, lastPage);
				if (lastPage == 0)
				{
					$('#swipePage'+numPage).attr("left", "#home");
				}
				else 
				{
					$('#swipePage'+lastPage).attr("right", "#page"+numPage);
					$('#swipePage'+numPage).attr("left", "#page"+lastPage);
				}
				lastPage = numPage;
			}
			var tweet = this;
			var shtml='';

			shtml=shtml+'<li>';
			shtml=shtml+'<img src=\"'+tweet.user.profile_image_url_https+'\" />';

			var txt = textWithLinks(tweet.text, tweet.entities.urls);

			shtml=shtml+txt;
			shtml=shtml+'<p> Count:'+tweet.retweet_count+'</p>';
			shtml=shtml+'</li>';
			
			shtml=shtml+'<li data-theme="b" data-rel="popup" data-role="list-divider" data-mini=true><a href="#profile'+numPage+''+count+'" data-rel="popup" data-role="button" data-inline="true" data-transition="pop" data-position-to="window">User Info</a></li>'

			$('#tweet'+numPage).append(shtml);
			makePopUpProfile(tweet, numPage, count);
			count = count + 1;
        });

    });

	function makePage(numPage, lastPage) {
		//header
		var header = document.createElement('div');
		header.setAttribute('data-role', 'header');
		header.setAttribute('data-theme', 'b');
		var headerH = document.createElement('h1');
		var headerText = document.createTextNode("My Favourite Things");
		//page
		var newPage = document.createElement('div');
		newPage.setAttribute('data-role', 'page');
		newPage.setAttribute('id', 'page'+numPage);
		//page content
		var content = document.createElement('div');
		content.setAttribute('data-role', 'content');
		//demo-html
		var demoHtml = document.createElement('div');
		demoHtml.setAttribute('data-demo-html', 'true');
		//listview
		//data goes in here
		var tweet = document.createElement('ul');
		tweet.setAttribute('id', 'tweet'+numPage);
		tweet.setAttribute('data-role', 'listview');
		tweet.setAttribute('data-inset', 'true');
		// footer/swipe
		var footer = document.createElement('div');
		footer.setAttribute('class', 'jqm-footer');
		var footerList = document.createElement('ul');
		footerList.setAttribute('data-role', 'listview');
		footerList.setAttribute('data-inset', 'true');
		var swipe = document.createElement('li');
		swipe.setAttribute('id', 'swipe'+numPage);
		swipe.setAttribute('class', 'changePage');
		var swipeValue = document.createElement('input');
		swipeValue.setAttribute('id', 'swipePage'+numPage);
		swipeValue.setAttribute('type', 'hidden');
		var swipeText = document.createTextNode("<<<< swipe to navigate page >>>>");
		
		swipe.appendChild(swipeText);
		swipe.appendChild(swipeValue);
		footerList.appendChild(swipe);
		footer.appendChild(footerList);

		demoHtml.appendChild(tweet);
		content.appendChild(demoHtml);
		
		headerH.appendChild(headerText);
		header.appendChild(headerH);

		newPage.appendChild(header);
		newPage.appendChild(content);
		newPage.appendChild(footer);

		$('body').append(newPage);
	}
	
	/*
	 * 
	 */
	function textWithLinks(text, urls) {
		
		var converted_text = '<h3>';

		urls_array = [];
		for (var i=0;i<urls.length;i++) {
			urls_array.push(urls[i].url);
		}

		var parsed_text = text.split(" "); 
		$(parsed_text).each(function() { 
			var index = urls_array.indexOf(this.toString());
			if(index != -1) {
				var link = '<a href='+this+'>'+this+'</a>';
				converted_text += link;
			} 
			else {
				converted_text += this;
			}
			converted_text += " ";
		});
		
		converted_text += '</h3>';
		return converted_text;
	}
	

	function makePopUpProfile (tweet, numPage, count) {
		var id = 'profile'+numPage +''+count;
		var popup = document.createElement('div');
		popup.setAttribute('data-role', 'popup');
		popup.setAttribute('id', id);
		popup.setAttribute('class', 'ui-content');
		popup.setAttribute('data-dismissible', 'false');
		popup.setAttribute('data-overlay-theme', 'a');

		var a = document.createElement('a');
		a.setAttribute('href', '#');
		a.setAttribute('data-rel', 'back');
		a.setAttribute('data-role', 'button');
		a.setAttribute('data-theme', 'a');
		a.setAttribute('data-icon', 'delete');
		a.setAttribute('data-iconpos', 'notext');
		a.setAttribute('class', 'ui-btn-right');
		var aText = document.createTextNode("Close");
		a.appendChild(aText);

		/*var background = document.createElement('img');
		background.setAttribute('class', 'popphoto');
		background.setAttribute('src', 'https://abs.twimg.com/a/1364441607/t1/img/grey_header_web.png');*/
		
		var background = document.createElement('div');
		background.setAttribute('class', 'profile-header-inner');
		//background.setAttribute('data-background-image', 'url("https://si0.twimg.com/profile_banners/7517222/1362427754/web")');
		background.setAttribute('style', 'height: 260px; width: 520px; position: relative; margin-left:auto; margin-right:auto; background-image: url("https://abs.twimg.com/a/1364441607/t1/img/grey_header_web.png");');
		
		var profileImg = document.createElement('img');
		profileImg.setAttribute('class', 'profpic');
		profileImg.setAttribute('src', tweet.user.profile_image_url_https);
		
		var name = document.createElement('h2');
		name.setAttribute('class', 'fullname');
		var nameText = document.createTextNode(tweet.user.screen_name+'  ');
		name.appendChild(nameText);
		
		if (tweet.user.verified) {
			var verified = document.createElement('img');
			verified.setAttribute('class', 'verified');
			verified.setAttribute('src', 'https://si0.twimg.com/help/1307051362_737');
			name.appendChild(verified);
		}
		
		background.appendChild(profileImg);
		background.appendChild(name);
		popup.appendChild(a);
		popup.appendChild(background);

		$('#page'+numPage).append(popup);
	}
</script>

/* Script for swipe event */
<script type="text/javascript">
	$(document).on('pagebeforecreate', function() {
		$(".changePage").swiperight(function(event) {
				var target = $(this).find("input").attr("right");
				if (target == undefined) {
					alert("You are in the last page of the application!");
					event.stopImmediatePropagation();
				}
				$.mobile.changePage(target);
				event.stopImmediatePropagation();
		});

		$(".changePage").swipeleft(function(event) {
				var target = $(this).find("input").attr("left");
				if (target == undefined) {
					alert("You are in the first page of the application!");
					event.stopImmediatePropagation();
				}
				$.mobile.changePage(target);
				event.stopImmediatePropagation();
		});

	});
</script>

<style>
	img.profpic {
		position:relative;
		top:15px;
		width:73px;
		height:73px;
		border: 3px solid white;
		margin-left:auto;
		margin-right:auto;
		display: block;
	}
	h2.fullname {
		position:relative;
		color: white;
		text-align:center;
 	}
	
<style>
</html>
