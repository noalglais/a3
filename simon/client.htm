<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="js/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="js/jquery.mobile-1.3.0-rc.1.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/a3.css">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/jqm-demos.css">
    <link rel="stylesheet" href="css/jquery.mobile-1.3.0-rc.1.css">
    <script src="js/jquery.mobile.pagination.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/jquery.mobile.pagination.css">
</head>
<body>
	<div data-role="page" id="home">
		<div data-role="header" data-theme="b">
			<h1>My Favourite Things</h1>
		</div><!-- /header -->

		<div data-role="content">
			<div data-demo-html="true">
				<ul data-role="listview" data-inset="true">
					<li data-role="list-divider" hidden="true"> Welcome! </li>
					<li> This application will organize list of favourites in twitter. Swipe right on the bottom strip to start the application</li>
				</ul>
			</div>
		</div>

		<div class="jqm-footer">
			<ul data-role="listview" data-inset="true">
				<li id="StartApp" class="changePage">
					Let's start the application >>>>
					<input id='swipePageHome' type=hidden right='#page1'></input>
				</li>
			</ul>
		</div>
	</div>

</body>


/* Script for creating new page and inserting tweets */
<script type="text/javascript">
    $.getJSON('favs.json', function (data) {
		var numPage = 1;
		var lastPage = 0;
		var tweetsPerPage = 10;
		var count = 1;
        $.each(data, function (index) {
			if (count > tweetsPerPage)
			{ // if tweet count exceeds 10 per page, reset the count and increment pageNum
				count = 1;
				numPage = numPage + 1;
			}

			if (count == 1)
			{ // if count = 0, we need to make new page
				$('#tweet'+numPage-1).listview("refresh");
				makePage(numPage, lastPage);
				if (lastPage == 0)
				{
					$('#swipePage'+numPage).attr("left", "#home");
				}
				else 
				{
					$('#swipePage'+lastPage).attr("right", "#page"+numPage);
					$('#swipePage'+numPage).attr("left", "#page"+lastPage);
				}
				lastPage = numPage;
			}
			var tweet = this;
			var shtml='';

			shtml=shtml+'<li>';
			shtml=shtml+'<img class=listProfile src=\"'+tweet.user.profile_image_url_https+'\" />';
 			shtml=shtml+'<h3>'+hashtag(textWithLinks(tweet.text, tweet.entities.urls))+'</h3>';
// 			var txt = textWithLinks(hashtag(tweet.text), tweet.entities.urls);
// 			var txt = hashtag(textWithLinks(tweet.text, tweet.entities.urls));
// 			shtml=shtml+txt;
			shtml=shtml+'<p> Count:'+tweet.retweet_count+'</p>';
			shtml=shtml+'</li>';
			
			shtml=shtml+'<li data-theme="b" data-rel="popup" data-role="list-divider" data-mini=true><a href="#profile'+numPage+''+count+'" data-rel="popup" data-role="button" data-inline="true" data-transition="slidedown" data-position-to="window">User Info</a></li>'

			$('#tweet'+numPage).append(shtml);
			makePopUpProfile(tweet, numPage, count);
			count = count + 1;
        });

    });

	function makePage(numPage, lastPage) {
		//header
		var header = document.createElement('div');
		header.setAttribute('data-role', 'header');
		header.setAttribute('data-theme', 'b');
		var headerH = document.createElement('h1');
		var headerText = document.createTextNode("My Favourite Things");
		//page
		var newPage = document.createElement('div');
		newPage.setAttribute('data-role', 'page');
		newPage.setAttribute('id', 'page'+numPage);
		//page content
		var content = document.createElement('div');
		content.setAttribute('data-role', 'content');
		//demo-html
		var demoHtml = document.createElement('div');
		demoHtml.setAttribute('data-demo-html', 'true');
		//listview
		//data goes in here
		var tweet = document.createElement('ul');
		tweet.setAttribute('id', 'tweet'+numPage);
		tweet.setAttribute('data-role', 'listview');
		tweet.setAttribute('data-inset', 'true');
		// footer/swipe
		var footer = document.createElement('div');
		footer.setAttribute('class', 'jqm-footer');
		var footerList = document.createElement('ul');
		footerList.setAttribute('data-role', 'listview');
		footerList.setAttribute('data-inset', 'true');
		var swipe = document.createElement('li');
		swipe.setAttribute('id', 'swipe'+numPage);
		swipe.setAttribute('class', 'changePage');
		var swipeValue = document.createElement('input');
		swipeValue.setAttribute('id', 'swipePage'+numPage);
		swipeValue.setAttribute('type', 'hidden');
		var swipeText = document.createTextNode("<<<< swipe to navigate page >>>>");
		
		swipe.appendChild(swipeText);
		swipe.appendChild(swipeValue);
		footerList.appendChild(swipe);
		footer.appendChild(footerList);

		demoHtml.appendChild(tweet);
		content.appendChild(demoHtml);
		
		headerH.appendChild(headerText);
		header.appendChild(headerH);

		newPage.appendChild(header);
		newPage.appendChild(content);
		newPage.appendChild(footer);

		$('body').append(newPage);
	}
	
	
	 /*
	 * 
	 */
	 function hashtag(tweets){
		  var occurence = tweets.split("#").length - 1;
		  var count = 0;
		  var holder =tweets;
			  while (count < occurence){
			    holder = hashhelper(holder);
			    count ++;
			    }
		  return holder;
	  } 
	  
	 /*
	 * 
	 */
	  function hashhelper(tweettext){
	    var parsed = tweettext.split(' ');
	    var i = 0;
	    while (i<parsed.length){
	      if (parsed[i][0] == '#'){
		var hash1 = parsed[i];
		var hash2 = parsed[i].substring(1);
		parsed[i]="<a href='#' class='hash' onclick=newwindow('https://twitter.com/search?q=%23"+hash2+"&src=hash') value='"+hash2+"'>"+hash1+"</a> ";
		return parsed.join(" ")
		} 
	    i++;}
	    return tweettext;
	  }
	
	/*
	 * 
	 */
	function newwindow(url){
		window.open(url);}
	
	
	/*
	 * tweet.entities.media.url
	 */
	function textWithLinks(text, urls) {

		var newstring= '<h3>';
		indices_array = [];
		urls_array = [];

		var counter=0;
		for (var i=0;i<urls.length;i++) {
			urls_array.push(urls[i].url);
			indices_array.push(urls[i].indices);
		}
		for (var a=0; a<urls_array.length; a++){
			//var link = "<a href='#' class ='link' onclick=newwindow('"+urls_array[a]+"') >"+urls_array[a]+"</a> ";
			newstring += text.substring(counter, indices_array[a][0]) + "<a href='#' class ='link' onclick=newwindow('"+urls_array[a]+"') >"+urls_array[a]+"</a> ";
			counter = indices_array[a][1];
		}
		newstring += text.substring(indices_array[a-1][1]);
		newstring += '</h3>';
		return newstring;
	}
	
	

	function makePopUpProfile (tweet, numPage, count) {
		var id = 'profile'+numPage +''+count;
		var popup = document.createElement('div');
		popup.setAttribute('data-role', 'popup');
		popup.setAttribute('id', id);
		popup.setAttribute('class', 'ui-content');
		popup.setAttribute('data-dismissible', 'false');
		popup.setAttribute('data-overlay-theme', 'a');

		var a = document.createElement('a');
		a.setAttribute('href', '#');
		a.setAttribute('data-rel', 'back');
		a.setAttribute('data-role', 'button');
		a.setAttribute('data-theme', 'a');
		a.setAttribute('data-icon', 'delete');
		a.setAttribute('data-iconpos', 'notext');
		a.setAttribute('class', 'ui-btn-right');
		var aText = document.createTextNode("Close");
		a.appendChild(aText);

		/*var background = document.createElement('img');
		background.setAttribute('class', 'popphoto');
		background.setAttribute('src', 'https://abs.twimg.com/a/1364441607/t1/img/grey_header_web.png');*/
		
		var background = document.createElement('div');
		background.setAttribute('class', 'profile-header-inner');
		//background.setAttribute('data-background-image', 'url("https://si0.twimg.com/profile_banners/7517222/1362427754/web")');
		background.setAttribute('style', 'word-wrap: break-word; min-height: 260px; max-width: 520px; position: relative; margin-left:auto; margin-right:auto; background-image: url("https://abs.twimg.com/a/1364441607/t1/img/grey_header_web.png");');
		
		var profileImg = document.createElement('img');
		profileImg.setAttribute('class', 'profpic');
		profileImg.setAttribute('src', tweet.user.profile_image_url_https);
		
		var name = document.createElement('p');
		name.setAttribute('class', 'fullname');
		var nameText = document.createTextNode(tweet.user.name+'  ');
		name.appendChild(nameText);
		
		if (tweet.user.verified) {
			var verified = document.createElement('img');
			verified.setAttribute('class', 'verified');
			verified.setAttribute('src', 'https://si0.twimg.com/help/1307051362_737');
			name.appendChild(verified);
		}
		
		var screenName = document.createElement('p');
		screenName.setAttribute('class', 'screenname');
		var screenText = document.createTextNode('@'+tweet.user.screen_name);
		screenName.appendChild(screenText);
		
		var description = document.createElement('p');
		description.setAttribute('class', 'des');
		var desText = document.createTextNode(tweet.user.description);
		description.appendChild(desText);
		
		var loc = document.createElement('p');
		loc.setAttribute('class', 'location');
		var locText = document.createTextNode(tweet.user.location + "  " + tweet.user.url);
		if (tweet.user.entities.url.urls.expanded_url) {
			var locText = document.createTextNode(tweet.user.location + "  " + tweet.user.entities.url.urls.expanded_url);
		}
		
		loc.appendChild(locText);
		
		background.appendChild(profileImg);
		background.appendChild(name);
		background.appendChild(screenName);
		background.appendChild(description);
		background.appendChild(loc);
		
		popup.appendChild(a);
		popup.appendChild(background);

		$('#page'+numPage).append(popup);
	}
</script>

/* Script for swipe event */
<script type="text/javascript">
	$(document).on('pagebeforecreate', function() {
		$(".changePage").swiperight(function(event) {
				var target = $(this).find("input").attr("right");
				if (target == undefined) {
					alert("You are in the last page of the application!");
					event.stopImmediatePropagation();
				}
				$.mobile.changePage(target);
				event.stopImmediatePropagation();
		});

		$(".changePage").swipeleft(function(event) {
				var target = $(this).find("input").attr("left");
				if (target == undefined) {
					alert("You are in the first page of the application!");
					event.stopImmediatePropagation();
				}
				$.mobile.changePage(target);
				event.stopImmediatePropagation();
		});

	});
</script>

<style>
	img.listProfile {
		height:80px;
		width:80px;
	}
	img.profpic {
		position:relative;
		top:15px;
		width:73px;
		height:73px;
		border: 3px solid white;
		margin-left:auto;
		margin-right:auto;
		display: block;
	}
	p.fullname {
		font-size: 18pt;
		position:relative;
		color: white;
		text-align:center;
 	}
	p.screenname {
		text-align:center;
		color:white;
	}
	p.des {
		padding-left:15px;
		padding-right:15px;
		text-align:center;
		color:white;
		position:relative;
	}
	p.location {
		text-align:center;
		color:white;
		position:relative;
		padding-bottom:15px;
	}
	.ui-li-heading{
		white-space: normal;
		word-wrap: break-word;
	}
<style>
</html>
